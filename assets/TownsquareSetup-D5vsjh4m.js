import{u as f,a as _,r as n,j as e,b as S,s as y,c as C,_ as b,d as g,e as w,f as N,g as T,h as E}from"./index-h1AOQiZ0.js";import{T as R,B as d,I as k,m as D,D as j,a as O,c as P,C as A,A as x}from"./index-CuHX5le-.js";import"./role-BNc36tb4.js";function I(){const a=f(c=>c.players.players),i=_(),[u,s]=n.useState(!1),[l,r]=n.useState(""),[p,t]=n.useState(0),o=()=>{s(!1)},h=()=>{i(y({index:p,name:l})),s(!1)},m=n.useRef(null);return n.useEffect(()=>{setTimeout(()=>{u&&m.current&&(m.current.focus(),m.current.select())},100)},[u]),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"relative flex w-full flex-grow place-content-center max-h-full",children:e.jsx("div",{className:"aspect-square max-h-full max-w-full",children:e.jsx(R,{tapAction:c=>{s(!0),t(c),r(a[c].name)},canDrag:!0,canRemove:!0,children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsx(d,{id:"add_player",onClick:()=>{i(S({}))},children:e.jsx(k,{path:D,size:2})})})})})}),e.jsx(j,{open:u,onClose:o,disableRestoreFocus:!0,children:e.jsxs("form",{method:"dialog",children:[e.jsx("p",{children:"Set the player's name"}),e.jsx(O,{type:"text",value:l,autoFocus:!0,inputRef:m,onKeyDown:c=>{c.key==="Enter"&&h()},onChange:c=>r(c.currentTarget.value)}),e.jsx(d,{onClick:h,children:"OK"}),e.jsx(d,{onClick:()=>{r(""),s(!1)},children:"Cancel"})]})})]})}const v=[{name:"Trouble Brewing",file:"troubleBrewing"},{name:"Sects & Violets",file:"sectsAndViolets"},{name:"Bad Moon Rising",file:"badMoonRising"}],V=Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"}));function B(){const[a,i]=n.useState(""),[u,s]=n.useState(""),l=f(t=>t.roles.script),r=_();n.useEffect(()=>{l!==""&&(s(l),i(l))},[l]),n.useEffect(()=>{a!==""&&(r(C({script:a})),b(Object.assign({"../game_scripts/badMoonRising.ts":()=>g(()=>import("./badMoonRising-C1cSTL1Q.js"),[]),"../game_scripts/scripts.ts":()=>g(()=>Promise.resolve().then(()=>V),void 0),"../game_scripts/sectsAndViolets.ts":()=>g(()=>import("./sectsAndViolets-JlA5fA-s.js"),[]),"../game_scripts/troubleBrewing.ts":()=>g(()=>import("./troubleBrewing-DOet0cCm.js"),[])}),`../game_scripts/${a}.ts`,3).then(t=>{const o=t.default;r(w({roles:o.slice(1)}))}).catch(t=>console.log("Error loading script!",t)))},[r,a]);const p=t=>{s(t.target.value),i(t.target.value)};return e.jsxs("div",{id:"script_setup",children:[e.jsx("label",{htmlFor:"script_select",children:"Choose a script"}),e.jsxs("select",{name:"scripts",id:"script_select",value:u,onChange:p,children:[a===""?e.jsx("option",{value:""},"none"):null,v.map(t=>e.jsx("option",{value:t.file,children:t.name},t.name))]})]})}function M(){const a=f(o=>o.roles.roles),i=f(o=>o.settings.tutorialStage),[u,s]=n.useState(!1),l=N(),r=_(),p=[{target:"body",content:"Let's go on a tour!",placement:"center"},{target:".token",content:"This represents a player, click on it to change their name, drag them around to place them"},{target:"#add_player",content:`You can add more players on this button
or drag some to the trash to remove them`},{target:"#script_setup",content:"Choose which script you want to play here",placement:"top"},{target:"#go_play",content:"When you are done, click  here",placement:"top"}],t=o=>{const{action:h}=o;[x.CLOSE,x.STOP,x.SKIP].includes(h)&&r(E({stage:1}))};return e.jsxs("div",{className:"h-dvh",children:[e.jsx(P,{steps:p,showSkipButton:!0,continuous:!0,callback:t,run:i<1}),e.jsx("div",{className:"h-2/3",children:e.jsx(I,{})}),e.jsxs("div",{className:"h-1/3",children:[e.jsx(B,{}),e.jsx(d,{onClick:()=>{s(!0)},disabled:a.length===0,children:"Show script"}),e.jsx("p",{id:"go_play",children:e.jsx(d,{onClick:()=>(r(T()),l("/play/townsquare",{replace:!0})),disabled:a.length===0,children:"Done"})})]}),e.jsx(j,{open:u,onClose:()=>{s(!1)},children:e.jsx(A,{highlights:null,closeDialog:()=>{s(!1)},tapCharacter:()=>{}})})]})}export{M as default};
